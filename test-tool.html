<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moonberry Ä°K - Test & Hata Raporlama</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', -apple-system, sans-serif; background: #0a0a0a; color: #fff; padding: 20px; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { color: #00c9a7; margin-bottom: 5px; font-size: 1.5rem; }
        h2 { color: #f1c40f; margin: 20px 0 10px; font-size: 1.1rem; }
        .subtitle { color: #888; margin-bottom: 20px; font-size: .9rem; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }
        
        .card { background: #111; border: 1px solid #333; border-radius: 12px; padding: 20px; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .card-title { font-weight: 600; color: #fff; }
        
        .btn { padding: 10px 20px; border: none; border-radius: 8px; font-size: .9rem; cursor: pointer; transition: all .2s; }
        .btn-primary { background: #00c9a7; color: #000; font-weight: 600; }
        .btn-primary:hover { background: #00b396; }
        .btn-secondary { background: #333; color: #fff; }
        .btn-secondary:hover { background: #444; }
        .btn-danger { background: #e74c3c; color: #fff; }
        .btn-sm { padding: 6px 12px; font-size: .8rem; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .test-item { display: flex; align-items: center; gap: 10px; padding: 10px; border-radius: 8px; margin-bottom: 8px; background: #1a1a1a; }
        .test-status { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: .8rem; flex-shrink: 0; }
        .test-status.pass { background: rgba(0,201,167,.2); color: #00c9a7; }
        .test-status.fail { background: rgba(231,76,60,.2); color: #e74c3c; }
        .test-status.warn { background: rgba(241,196,15,.2); color: #f1c40f; }
        .test-status.pending { background: rgba(136,136,136,.2); color: #888; }
        .test-name { flex: 1; font-size: .85rem; }
        .test-time { color: #666; font-size: .75rem; }
        
        .stats-row { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
        .stat-box { background: #1a1a1a; padding: 15px 20px; border-radius: 10px; text-align: center; min-width: 100px; }
        .stat-value { font-size: 1.8rem; font-weight: 700; }
        .stat-value.green { color: #00c9a7; }
        .stat-value.red { color: #e74c3c; }
        .stat-value.yellow { color: #f1c40f; }
        .stat-label { color: #888; font-size: .75rem; }
        
        .log-area { background: #0a0a0a; border: 1px solid #333; border-radius: 8px; padding: 15px; max-height: 300px; overflow-y: auto; font-family: monospace; font-size: .8rem; }
        .log-success { color: #00c9a7; }
        .log-error { color: #e74c3c; }
        .log-warn { color: #f1c40f; }
        .log-info { color: #3498db; }
        
        .report-section { margin-top: 20px; }
        .report-box { background: #1a1a1a; border: 1px solid #333; border-radius: 8px; padding: 15px; margin-top: 10px; }
        textarea { width: 100%; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; padding: 12px; color: #fff; font-family: inherit; font-size: .9rem; resize: vertical; min-height: 100px; }
        textarea:focus { outline: none; border-color: #00c9a7; }
        
        .copy-btn { position: absolute; top: 10px; right: 10px; }
        .relative { position: relative; }
        
        .progress-bar { height: 6px; background: #333; border-radius: 3px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #00c9a7, #008c95); transition: width .3s; }
        
        .badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: .7rem; margin-left: 8px; }
        .badge-success { background: rgba(0,201,167,.2); color: #00c9a7; }
        .badge-error { background: rgba(231,76,60,.2); color: #e74c3c; }
        
        .collapsible { cursor: pointer; }
        .collapsible-content { display: none; margin-top: 10px; padding-top: 10px; border-top: 1px solid #333; }
        .collapsible-content.show { display: block; }
        
        .screenshot-area { border: 2px dashed #333; border-radius: 8px; padding: 20px; text-align: center; margin-top: 10px; cursor: pointer; transition: all .2s; }
        .screenshot-area:hover { border-color: #00c9a7; background: rgba(0,201,167,.05); }
        .screenshot-preview { max-width: 100%; border-radius: 8px; margin-top: 10px; }
        
        #manualTestForm input, #manualTestForm select { width: 100%; background: #1a1a1a; border: 1px solid #333; border-radius: 6px; padding: 10px; color: #fff; margin-bottom: 10px; }
        #manualTestForm label { display: block; color: #888; font-size: .8rem; margin-bottom: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Test & Hata Raporlama</h1>
        <p class="subtitle">Moonberry Ä°K - Otomatik Test ve Manuel Hata Bildirimi</p>
        
        <!-- Ä°statistikler -->
        <div class="stats-row">
            <div class="stat-box">
                <div class="stat-value green" id="passCount">0</div>
                <div class="stat-label">BaÅŸarÄ±lÄ±</div>
            </div>
            <div class="stat-box">
                <div class="stat-value red" id="failCount">0</div>
                <div class="stat-label">BaÅŸarÄ±sÄ±z</div>
            </div>
            <div class="stat-box">
                <div class="stat-value yellow" id="warnCount">0</div>
                <div class="stat-label">UyarÄ±</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="totalTests" style="color:#fff">0</div>
                <div class="stat-label">Toplam Test</div>
            </div>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width:0%"></div>
        </div>
        
        <div class="grid">
            <!-- Sol: Otomatik Testler -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ğŸ¤– Otomatik Testler</span>
                    <button class="btn btn-primary btn-sm" onclick="runAllTests()" id="btnRunTests">TÃ¼mÃ¼nÃ¼ Ã‡alÄ±ÅŸtÄ±r</button>
                </div>
                
                <div id="testResults">
                    <div class="test-item">
                        <div class="test-status pending">â³</div>
                        <span class="test-name">Testler bekleniyor...</span>
                    </div>
                </div>
            </div>
            
            <!-- SaÄŸ: Manuel Hata Bildirimi -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">ğŸ“ Manuel Hata Bildirimi</span>
                </div>
                
                <form id="manualTestForm">
                    <label>Sayfa / ModÃ¼l</label>
                    <select id="bugPage">
                        <option value="">SeÃ§iniz...</option>
                        <option value="login">GiriÅŸ SayfasÄ±</option>
                        <option value="dashboard">Dashboard</option>
                        <option value="shift">Shift PlanÄ±</option>
                        <option value="checklist">Checklist</option>
                        <option value="puantaj">Puantaj</option>
                        <option value="personel">Personel</option>
                        <option value="belgeler">Belgeler</option>
                        <option value="ayarlar">Ayarlar</option>
                        <option value="other">DiÄŸer</option>
                    </select>
                    
                    <label>Hata TÃ¼rÃ¼</label>
                    <select id="bugType">
                        <option value="">SeÃ§iniz...</option>
                        <option value="crash">ğŸ”´ Sayfa Ã‡Ã¶kÃ¼yor</option>
                        <option value="error">ğŸŸ  Hata MesajÄ±</option>
                        <option value="ui">ğŸŸ¡ GÃ¶rsel Sorun</option>
                        <option value="function">ğŸŸ¡ Fonksiyon Ã‡alÄ±ÅŸmÄ±yor</option>
                        <option value="slow">ğŸŸ¢ YavaÅŸlÄ±k</option>
                        <option value="typo">ğŸŸ¢ YazÄ±m HatasÄ±</option>
                        <option value="suggestion">ğŸ’¡ Ã–neri</option>
                    </select>
                    
                    <label>AÃ§Ä±klama</label>
                    <textarea id="bugDescription" placeholder="HatayÄ± detaylÄ± aÃ§Ä±klayÄ±n...&#10;- Ne yapmaya Ã§alÄ±ÅŸtÄ±nÄ±z?&#10;- Ne olmasÄ± gerekiyordu?&#10;- Ne oldu?"></textarea>
                    
                    <label>Console HatalarÄ± (varsa)</label>
                    <textarea id="bugConsole" placeholder="F12 > Console'dan kopyalayÄ±p yapÄ±ÅŸtÄ±rÄ±n..."></textarea>
                    
                    <div class="screenshot-area" onclick="document.getElementById('screenshotInput').click()">
                        ğŸ“¸ Ekran gÃ¶rÃ¼ntÃ¼sÃ¼ eklemek iÃ§in tÄ±klayÄ±n veya sÃ¼rÃ¼kleyin
                        <input type="file" id="screenshotInput" accept="image/*" style="display:none" onchange="handleScreenshot(this)">
                    </div>
                    <img id="screenshotPreview" class="screenshot-preview" style="display:none">
                    
                    <div style="margin-top:15px; display:flex; gap:10px;">
                        <button type="button" class="btn btn-primary" onclick="submitBugReport()">ğŸ“¤ Raporu Ekle</button>
                        <button type="button" class="btn btn-secondary" onclick="clearForm()">ğŸ—‘ï¸ Temizle</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Test Logu -->
        <div class="card" style="margin-top:20px">
            <div class="card-header">
                <span class="card-title">ğŸ“œ Test Logu</span>
                <button class="btn btn-secondary btn-sm" onclick="clearLog()">Temizle</button>
            </div>
            <div class="log-area" id="logArea">HazÄ±r...</div>
        </div>
        
        <!-- Rapor Ã‡Ä±ktÄ±sÄ± -->
        <div class="card" style="margin-top:20px">
            <div class="card-header">
                <span class="card-title">ğŸ“‹ Rapor Ã‡Ä±ktÄ±sÄ± (Claude'a GÃ¶nder)</span>
                <button class="btn btn-primary btn-sm" onclick="copyReport()">ğŸ“‹ Kopyala</button>
            </div>
            <div class="relative">
                <textarea id="reportOutput" readonly style="min-height:200px; font-family:monospace; font-size:.8rem;">HenÃ¼z rapor oluÅŸturulmadÄ±. Test Ã§alÄ±ÅŸtÄ±rÄ±n veya manuel hata ekleyin.</textarea>
            </div>
        </div>
    </div>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyCbc-8oWwOj2eR0J19f3T-UYT9vGI8PL7M",
            authDomain: "moonberry-ik.firebaseapp.com",
            projectId: "moonberry-ik",
            storageBucket: "moonberry-ik.firebasestorage.app",
            messagingSenderId: "4872042742",
            appId: "1:4872042742:web:24a9e5935e2b5591a794d7"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        // Test SonuÃ§larÄ±
        let testResults = [];
        let manualBugs = [];
        let stats = { pass: 0, fail: 0, warn: 0, total: 0 };
        
        // ==================== TEST TANIMLARI ====================
        
        const TESTS = [
            // Firebase Testleri
            { id: 'fb_auth', name: 'Firebase Auth BaÄŸlantÄ±sÄ±', category: 'Firebase', test: testFirebaseAuth },
            { id: 'fb_db', name: 'Firestore BaÄŸlantÄ±sÄ±', category: 'Firebase', test: testFirestoreConnection },
            { id: 'fb_personel', name: 'Personel Koleksiyonu', category: 'Firebase', test: testPersonelCollection },
            { id: 'fb_shifts', name: 'Shifts Koleksiyonu', category: 'Firebase', test: testShiftsCollection },
            { id: 'fb_config', name: 'Config Koleksiyonu', category: 'Firebase', test: testConfigCollection },
            { id: 'fb_checklist', name: 'Checklist Types', category: 'Firebase', test: testChecklistTypes },
            { id: 'fb_sysconfig', name: 'System Config', category: 'Firebase', test: testSystemConfig },
            
            // Veri BÃ¼tÃ¼nlÃ¼ÄŸÃ¼ Testleri
            { id: 'data_branches', name: 'Åube Verileri', category: 'Veri', test: testBranchData },
            { id: 'data_checklist_items', name: 'Checklist Maddeleri', category: 'Veri', test: testChecklistItems },
            
            // URL/Dosya Testleri
            { id: 'file_css', name: 'CSS DosyasÄ±', category: 'Dosya', test: testCSSFile },
            { id: 'file_js', name: 'Legacy.js DosyasÄ±', category: 'Dosya', test: testJSFile },
        ];
        
        // ==================== TEST FONKSÄ°YONLARI ====================
        
        async function testFirebaseAuth() {
            const user = auth.currentUser;
            if (user) {
                return { status: 'pass', message: `GiriÅŸ yapÄ±lmÄ±ÅŸ: ${user.email}` };
            } else {
                return { status: 'warn', message: 'GiriÅŸ yapÄ±lmamÄ±ÅŸ - ana uygulamadan giriÅŸ yapÄ±n' };
            }
        }
        
        async function testFirestoreConnection() {
            try {
                await db.collection('personel').limit(1).get();
                return { status: 'pass', message: 'Firestore baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ±' };
            } catch (e) {
                return { status: 'fail', message: `Firestore hatasÄ±: ${e.message}` };
            }
        }
        
        async function testPersonelCollection() {
            try {
                const snap = await db.collection('personel').get();
                if (snap.size > 0) {
                    return { status: 'pass', message: `${snap.size} personel kaydÄ± bulundu` };
                } else {
                    return { status: 'warn', message: 'Personel koleksiyonu boÅŸ' };
                }
            } catch (e) {
                return { status: 'fail', message: `Hata: ${e.message}` };
            }
        }
        
        async function testShiftsCollection() {
            try {
                const snap = await db.collection('shifts').get();
                if (snap.size > 0) {
                    return { status: 'pass', message: `${snap.size} shift kaydÄ± bulundu` };
                } else {
                    return { status: 'warn', message: 'Shift koleksiyonu boÅŸ' };
                }
            } catch (e) {
                return { status: 'fail', message: `Hata: ${e.message}` };
            }
        }
        
        async function testConfigCollection() {
            try {
                const doc = await db.collection('config').doc('checklistTypes').get();
                if (doc.exists) {
                    const data = doc.data();
                    const branches = Object.keys(data).filter(k => k !== 'updatedAt');
                    return { status: 'pass', message: `Config mevcut: ${branches.length} ÅŸube` };
                } else {
                    return { status: 'fail', message: 'checklistTypes config bulunamadÄ±' };
                }
            } catch (e) {
                return { status: 'fail', message: `Hata: ${e.message}` };
            }
        }
        
        async function testChecklistTypes() {
            try {
                const doc = await db.collection('config').doc('checklistTypes').get();
                if (!doc.exists) {
                    return { status: 'fail', message: 'Checklist tÃ¼rleri bulunamadÄ±' };
                }
                
                const data = doc.data();
                let totalTypes = 0;
                let totalItems = 0;
                
                for (const [branch, types] of Object.entries(data)) {
                    if (branch === 'updatedAt') continue;
                    if (Array.isArray(types)) {
                        totalTypes += types.length;
                        types.forEach(t => {
                            if (t.items && Array.isArray(t.items)) {
                                totalItems += t.items.length;
                            }
                        });
                    }
                }
                
                if (totalTypes > 0 && totalItems > 0) {
                    return { status: 'pass', message: `${totalTypes} tÃ¼r, ${totalItems} madde` };
                } else {
                    return { status: 'warn', message: 'Checklist maddeleri eksik olabilir' };
                }
            } catch (e) {
                return { status: 'fail', message: `Hata: ${e.message}` };
            }
        }
        
        async function testSystemConfig() {
            try {
                const doc = await db.collection('systemConfig').doc('checkRules').get();
                if (doc.exists) {
                    const data = doc.data();
                    const hasRules = data.checkRules && data.checkRules.platforms;
                    return { status: hasRules ? 'pass' : 'warn', message: hasRules ? 'System config tam' : 'checkRules eksik' };
                } else {
                    return { status: 'warn', message: 'systemConfig/checkRules bulunamadÄ±' };
                }
            } catch (e) {
                if (e.message.includes('permission')) {
                    return { status: 'fail', message: 'Ä°zin hatasÄ± - Firestore rules kontrol edin' };
                }
                return { status: 'fail', message: `Hata: ${e.message}` };
            }
        }
        
        async function testBranchData() {
            try {
                const doc = await db.collection('config').doc('checklistTypes').get();
                if (!doc.exists) {
                    return { status: 'fail', message: 'Config bulunamadÄ±' };
                }
                
                const data = doc.data();
                const branches = Object.keys(data).filter(k => k !== 'updatedAt');
                
                const expectedBranches = ['Tuzla Port', 'ÅiÅŸli (Merkez)'];
                const missing = expectedBranches.filter(b => !branches.includes(b));
                
                if (missing.length === 0) {
                    return { status: 'pass', message: `TÃ¼m ÅŸubeler mevcut: ${branches.join(', ')}` };
                } else {
                    return { status: 'warn', message: `Eksik ÅŸubeler: ${missing.join(', ')}` };
                }
            } catch (e) {
                return { status: 'fail', message: `Hata: ${e.message}` };
            }
        }
        
        async function testChecklistItems() {
            try {
                const doc = await db.collection('config').doc('checklistTypes').get();
                if (!doc.exists) {
                    return { status: 'fail', message: 'Config bulunamadÄ±' };
                }
                
                const data = doc.data();
                let issues = [];
                
                for (const [branch, types] of Object.entries(data)) {
                    if (branch === 'updatedAt') continue;
                    if (!Array.isArray(types)) continue;
                    
                    for (const type of types) {
                        if (!type.items || type.items.length === 0) {
                            issues.push(`${branch}/${type.name}: madde yok`);
                        }
                    }
                }
                
                if (issues.length === 0) {
                    return { status: 'pass', message: 'TÃ¼m checklist tÃ¼rlerinde maddeler var' };
                } else {
                    return { status: 'warn', message: issues.slice(0, 3).join('; ') };
                }
            } catch (e) {
                return { status: 'fail', message: `Hata: ${e.message}` };
            }
        }
        
        async function testCSSFile() {
            try {
                const response = await fetch('css/styles.css', { method: 'HEAD' });
                if (response.ok) {
                    return { status: 'pass', message: 'CSS dosyasÄ± eriÅŸilebilir' };
                } else {
                    return { status: 'fail', message: `CSS yÃ¼klenemedi: ${response.status}` };
                }
            } catch (e) {
                return { status: 'fail', message: `CSS hatasÄ±: ${e.message}` };
            }
        }
        
        async function testJSFile() {
            try {
                const response = await fetch('js/legacy.js', { method: 'HEAD' });
                if (response.ok) {
                    return { status: 'pass', message: 'JS dosyasÄ± eriÅŸilebilir' };
                } else {
                    return { status: 'fail', message: `JS yÃ¼klenemedi: ${response.status}` };
                }
            } catch (e) {
                return { status: 'fail', message: `JS hatasÄ±: ${e.message}` };
            }
        }
        
        // ==================== TEST Ã‡ALIÅTIRICI ====================
        
        async function runAllTests() {
            const btn = document.getElementById('btnRunTests');
            btn.disabled = true;
            btn.textContent = 'â³ Ã‡alÄ±ÅŸÄ±yor...';
            
            testResults = [];
            stats = { pass: 0, fail: 0, warn: 0, total: TESTS.length };
            
            const resultsEl = document.getElementById('testResults');
            resultsEl.innerHTML = '';
            
            log('ğŸš€ Testler baÅŸlatÄ±lÄ±yor...', 'info');
            
            for (let i = 0; i < TESTS.length; i++) {
                const test = TESTS[i];
                const startTime = Date.now();
                
                // UI'da pending gÃ¶ster
                resultsEl.innerHTML += `
                    <div class="test-item" id="test-${test.id}">
                        <div class="test-status pending">â³</div>
                        <span class="test-name">${test.name}</span>
                        <span class="test-time">...</span>
                    </div>
                `;
                
                try {
                    const result = await test.test();
                    const duration = Date.now() - startTime;
                    
                    testResults.push({
                        id: test.id,
                        name: test.name,
                        category: test.category,
                        ...result,
                        duration
                    });
                    
                    stats[result.status]++;
                    
                    // UI gÃ¼ncelle
                    const itemEl = document.getElementById(`test-${test.id}`);
                    const statusIcon = result.status === 'pass' ? 'âœ…' : result.status === 'fail' ? 'âŒ' : 'âš ï¸';
                    itemEl.innerHTML = `
                        <div class="test-status ${result.status}">${statusIcon}</div>
                        <span class="test-name">${test.name}</span>
                        <span class="test-time">${duration}ms</span>
                    `;
                    
                    log(`${statusIcon} ${test.name}: ${result.message}`, result.status === 'pass' ? 'success' : result.status === 'fail' ? 'error' : 'warn');
                    
                } catch (e) {
                    testResults.push({
                        id: test.id,
                        name: test.name,
                        category: test.category,
                        status: 'fail',
                        message: `Exception: ${e.message}`,
                        duration: Date.now() - startTime
                    });
                    stats.fail++;
                    log(`âŒ ${test.name}: ${e.message}`, 'error');
                }
                
                // Progress gÃ¼ncelle
                updateStats();
            }
            
            log('', 'info');
            log(`âœ… Testler tamamlandÄ±: ${stats.pass} baÅŸarÄ±lÄ±, ${stats.fail} baÅŸarÄ±sÄ±z, ${stats.warn} uyarÄ±`, 'success');
            
            generateReport();
            
            btn.disabled = false;
            btn.textContent = 'TÃ¼mÃ¼nÃ¼ Ã‡alÄ±ÅŸtÄ±r';
        }
        
        function updateStats() {
            document.getElementById('passCount').textContent = stats.pass;
            document.getElementById('failCount').textContent = stats.fail;
            document.getElementById('warnCount').textContent = stats.warn;
            document.getElementById('totalTests').textContent = stats.total;
            
            const progress = ((stats.pass + stats.fail + stats.warn) / stats.total) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }
        
        // ==================== MANUEL HATA BÄ°LDÄ°RÄ°MÄ° ====================
        
        function handleScreenshot(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('screenshotPreview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        function submitBugReport() {
            const page = document.getElementById('bugPage').value;
            const type = document.getElementById('bugType').value;
            const description = document.getElementById('bugDescription').value;
            const console = document.getElementById('bugConsole').value;
            const screenshot = document.getElementById('screenshotPreview').src;
            
            if (!page || !type || !description) {
                alert('LÃ¼tfen sayfa, tÃ¼r ve aÃ§Ä±klama alanlarÄ±nÄ± doldurun.');
                return;
            }
            
            manualBugs.push({
                page,
                type,
                description,
                console,
                hasScreenshot: screenshot ? true : false,
                timestamp: new Date().toISOString()
            });
            
            log(`ğŸ“ Manuel hata eklendi: ${page} - ${type}`, 'info');
            clearForm();
            generateReport();
            
            alert('Hata raporu eklendi! Rapor Ã§Ä±ktÄ±sÄ±ndan kopyalayabilirsiniz.');
        }
        
        function clearForm() {
            document.getElementById('bugPage').value = '';
            document.getElementById('bugType').value = '';
            document.getElementById('bugDescription').value = '';
            document.getElementById('bugConsole').value = '';
            document.getElementById('screenshotPreview').style.display = 'none';
            document.getElementById('screenshotPreview').src = '';
        }
        
        // ==================== RAPOR OLUÅTURMA ====================
        
        function generateReport() {
            const now = new Date().toLocaleString('tr-TR');
            let report = `# ğŸ§ª MOONBERRY Ä°K TEST RAPORU\n`;
            report += `ğŸ“… Tarih: ${now}\n`;
            report += `ğŸŒ Site: https://ik.moonberrycoffee.com/\n\n`;
            
            // Ã–zet
            report += `## ğŸ“Š Ã–ZET\n`;
            report += `- âœ… BaÅŸarÄ±lÄ±: ${stats.pass}\n`;
            report += `- âŒ BaÅŸarÄ±sÄ±z: ${stats.fail}\n`;
            report += `- âš ï¸ UyarÄ±: ${stats.warn}\n`;
            report += `- ğŸ“ Manuel Hata: ${manualBugs.length}\n\n`;
            
            // Otomatik Test SonuÃ§larÄ±
            if (testResults.length > 0) {
                report += `## ğŸ¤– OTOMATÄ°K TEST SONUÃ‡LARI\n\n`;
                
                const failed = testResults.filter(t => t.status === 'fail');
                const warned = testResults.filter(t => t.status === 'warn');
                const passed = testResults.filter(t => t.status === 'pass');
                
                if (failed.length > 0) {
                    report += `### âŒ BaÅŸarÄ±sÄ±z (${failed.length})\n`;
                    failed.forEach(t => {
                        report += `- **${t.name}**: ${t.message}\n`;
                    });
                    report += `\n`;
                }
                
                if (warned.length > 0) {
                    report += `### âš ï¸ UyarÄ±lar (${warned.length})\n`;
                    warned.forEach(t => {
                        report += `- **${t.name}**: ${t.message}\n`;
                    });
                    report += `\n`;
                }
                
                if (passed.length > 0) {
                    report += `### âœ… BaÅŸarÄ±lÄ± (${passed.length})\n`;
                    passed.forEach(t => {
                        report += `- ${t.name}: ${t.message}\n`;
                    });
                    report += `\n`;
                }
            }
            
            // Manuel Hatalar
            if (manualBugs.length > 0) {
                report += `## ğŸ“ MANUEL BÄ°LDÄ°RÄ°LEN HATALAR\n\n`;
                manualBugs.forEach((bug, i) => {
                    report += `### Hata #${i + 1}: ${bug.page} - ${bug.type}\n`;
                    report += `**AÃ§Ä±klama:** ${bug.description}\n`;
                    if (bug.console) {
                        report += `**Console:** \`\`\`\n${bug.console}\n\`\`\`\n`;
                    }
                    report += `\n`;
                });
            }
            
            report += `---\n`;
            report += `*Bu rapor test-tool.html tarafÄ±ndan otomatik oluÅŸturulmuÅŸtur.*`;
            
            document.getElementById('reportOutput').value = report;
        }
        
        function copyReport() {
            const report = document.getElementById('reportOutput');
            report.select();
            document.execCommand('copy');
            alert('Rapor panoya kopyalandÄ±!');
        }
        
        // ==================== LOG ====================
        
        function log(message, type = 'info') {
            const logEl = document.getElementById('logArea');
            const time = new Date().toLocaleTimeString('tr-TR');
            if (message === '') {
                logEl.innerHTML += `<div>&nbsp;</div>`;
            } else {
                logEl.innerHTML += `<div class="log-${type}">[${time}] ${message}</div>`;
            }
            logEl.scrollTop = logEl.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('logArea').innerHTML = 'Log temizlendi...';
        }
        
        // Sayfa yÃ¼klendiÄŸinde
        auth.onAuthStateChanged(user => {
            if (user) {
                log(`âœ… Oturum aÃ§Ä±k: ${user.email}`, 'success');
            } else {
                log('âš ï¸ Oturum aÃ§Ä±k deÄŸil - bazÄ± testler baÅŸarÄ±sÄ±z olabilir', 'warn');
            }
        });
    </script>
</body>
</html>
