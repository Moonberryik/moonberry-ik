rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ==================== YARDIMCI FONKSİYONLAR ====================
    function isAuthenticated() {
      return request.auth != null;
    }
    
    function getUserData() {
      return get(/databases/$(database)/documents/users/$(request.auth.uid)).data;
    }
    
    function getUserRole() {
      return getUserData().role;
    }
    
    function isAdmin() {
      return isAuthenticated() && getUserRole() == 'yonetici';
    }
    
    function isManager() {
      return isAuthenticated() && getUserRole() in ['yonetici', 'bolge_muduru', 'magaza_muduru'];
    }
    
    // ==================== KOLEKSİYON KURALLARI ====================
    
    // Personel - LOGIN İÇİN ANONİM OKUMA İZNİ
    match /personel/{docId} {
      allow read: if true;
      allow write: if isAuthenticated();
    }
    
    // Kullanıcılar
    match /users/{userId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Puantaj
    match /puantaj/{docId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Puantaj Kuralları
    match /puantajRules/{docId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Puantaj Notları
    match /puantajNotes/{docId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Vardiyalar
    match /shifts/{docId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Oturumlar
    match /sessions/{docId} {
      allow read, write: if isAuthenticated();
    }
    
    // Ayarlar
    match /settings/{docId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Config
    match /config/{docId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // İzinler
    match /permissions/{docId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Gelişmiş İzinler
    match /advancedPermissions/{docId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Aktivite Logları
    match /activityLogs/{docId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Loglar
    match /logs/{docId} {
      allow read: if isAuthenticated();
      allow create: if isAuthenticated();
    }
    
    // Şubeler
    match /branches/{docId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Pozisyonlar
    match /positions/{docId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Şablonlar
    match /templates/{docId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // İhlaller
    match /violations/{docId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Belgeler
    match /documents/{docId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Checklistler
    match /checklists/{docId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Checklist Maddeleri
    match /checklistItems/{docId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Checklist Gönderimleri
    match /checklistSubmissions/{docId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
    // Checklist Türleri
    match /checklistTypes/{docId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated();
    }
    
  }
}
